<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Password Generator</title>
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><circle cx='50' cy='50' r='45' fill='%230b66c3'/><circle cx='50' cy='50' r='40' fill='%23f6f8fa'/><text x='50' y='65' font-size='50' font-weight='bold' text-anchor='middle' fill='%230b66c3'>üîê</text></svg>" type="image/svg+xml">
  <style>
    body {
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      background: #f6f8fa;
      color: #222;
      padding: 28px;
      display: flex;
      justify-content: center;
    }
    .card {
      width: 760px;
      background: white;
      border-radius: 10px;
      box-shadow: 0 6px 18px rgba(0,0,0,0.08);
      padding: 20px;
    }
    @media (max-width: 768px) {
      .card {
        width: 100%;
        max-width: 100%;
        padding: 16px;
      }
    }
    h1 { margin: 0 0 12px 0; font-size: 20px; }
    .row { display:flex; gap:12px; align-items:center; margin:8px 0; flex-wrap:wrap; }
    @media (max-width: 768px) {
      .row {
        flex-direction: column;
        align-items: flex-start;
      }
    }
    .controls { background:#eef6ec; padding:14px; border-radius:8px; margin-top:12px; }
    label { display:flex; gap:8px; align-items:center; font-size:14px; }
    input[type="range"] { width:100%; }
    input[type="text"] {
      width:100%;
      padding:12px 14px;
      font-size:18px;
      border-radius:8px;
      border:1px solid #d6dbe0;
      box-sizing: border-box;
      word-break: break-all;
      overflow-wrap: break-word;
      white-space: normal;
      resize: none;
      min-height: auto;
      height: auto;
      line-height: 1.5;
    }
    @media (max-width: 768px) {
      input[type="text"] {
        font-size: 13px;
        padding: 10px 12px;
        min-height: auto;
      }
    }
    .btn {
      padding:10px 14px;
      border-radius:8px;
      border: none;
      cursor:pointer;
      font-weight:600;
    }
    @media (max-width: 768px) {
      .btn {
        padding: 8px 10px;
        font-size: 13px;
      }
      #langEnBtn, #langEsBtn {
        padding: 6px 8px;
      }
    }
    .btn-refresh { background:#f0f6fb; color:#0b66c3; }
    .btn-copy { background:#d92d6a; color:white; }
    .small { font-size:13px; color:#444; }
    .checkboxes { display:flex; gap:18px; flex-wrap:wrap; }
    @media (max-width: 768px) {
      .checkboxes {
        flex-direction: column;
        gap: 16px;
      }
      [style*="width:280px"] {
        width: 100% !important;
      }
    }
    .footer { margin-top:16px; }
    .strength-container {
      margin-top:8px;
      height:10px;
      width:100%;
      background:#ddd;
      border-radius:5px;
      overflow:hidden;
    }
    .strength-bar {
      height:10px;
      width:0%;
      background:#ccc;
      transition: width 0.3s ease, background 0.3s ease;
    }
    .strength-label {
      font-size:13px;
      font-weight:600;
      margin-top:6px;
    }
    .hint { font-size:12px; color:#666; }
    .history-section {
      margin-top: 24px;
      padding-top: 16px;
      border-top: 1px solid #e0e0e0;
    }
    .history-title {
      font-size: 13px;
      font-weight: 600;
      color: #444;
      margin-bottom: 10px;
    }
    .history-list {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }
    .history-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px 12px;
      background: #f5f5f5;
      border-radius: 6px;
      font-family: monospace;
      font-size: 13px;
      word-break: break-all;
    }
    .history-copy-btn {
      padding: 6px 10px;
      background: #0b66c3;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 12px;
      white-space: nowrap;
      margin-left: 8px;
      flex-shrink: 0;
    }
    .history-copy-btn:hover {
      background: #0952a0;
    }
  </style>
</head>
<body>
  <div class="card" role="main">
      <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:12px;">
        <h1 style="margin:0;">Password generator</h1>
        <div style="display:flex; gap:8px; flex-shrink:0;">
          <button id="langEnBtn" class="btn" style="background:#e8f0ff; color:#0b66c3; padding:8px 12px; border:2px solid #0b66c3; line-height:1; display:flex; align-items:center; justify-content:center;" title="English">
            <img src="https://emojis.wiki/emoji-pics/apple/united-states-apple.png" alt="US" style="width:30px; height:30px;">
          </button>
          <button id="langEsBtn" class="btn" style="background:#f0f0f0; color:#666; padding:8px 12px; border:2px solid #ddd; line-height:1; display:flex; align-items:center; justify-content:center;" title="Espa√±ol">
            <img src="https://hotemoji.com/images/emoji/c/eppyfhslxy8c.png" alt="SV" style="width:30px; height:30px;">
          </button>
        </div>
      </div>

    <div style="display:grid; grid-template-columns: 1fr 200px; gap:12px; align-items:flex-start; min-width: 0;">
      <textarea id="passwordField" readonly aria-label="Generated password" style="min-width: 0; width: 100%; padding: 12px 14px; font-size: 18px; border-radius: 8px; border: 1px solid #d6dbe0; box-sizing: border-box; word-break: break-all; overflow-wrap: break-word; white-space: normal; resize: none; line-height: 1.5; font-family: monospace;"></textarea>
      <div style="display:flex; gap:8px; flex-shrink: 0;">
        <button id="refreshBtn" class="btn btn-refresh" title="Generate new password" data-i18n="refresh">‚ü≤ Refresh</button>
        <button id="copyBtn" class="btn btn-copy" title="Copy password to clipboard" data-i18n="copy">Copy password</button>
      </div>
    </div>

    <style>
      #passwordField {
        resize: none;
        overflow: hidden;
        min-height: 0;
        padding: 12px 14px;
      }
      @media (max-width: 768px) {
        #passwordField {
          font-size: 13px;
          padding: 10px 12px;
          min-height: 0;
        }
        [style*="grid-template-columns: 1fr 200px"] {
          grid-template-columns: 1fr !important;
          min-width: 0 !important;
        }
        [style*="grid-template-columns: 1fr 200px"] > div {
          display: flex !important;
          flex-direction: column !important;
          gap: 8px !important;
          width: 100%;
          flex-shrink: 0;
        }
        [style*="grid-template-columns: 1fr 200px"] > div > button {
          width: 100%;
        }
      }
    </style>

    <div class="controls">
      <div class="row">
        <div style="flex:1;">
          <div class="small" style="display:flex; gap:12px; align-items:center;">
            <label for="lengthInput" data-i18n="passwordLength">Password length:</label>
            <input id="lengthInput" type="number" min="5" max="100" value="20" style="width:60px; padding:6px 8px; border:1px solid #d6dbe0; border-radius:4px; font-size:14px;" />
          </div>
          <input id="lengthRange" type="range" min="5" max="100" value="20" />
        </div>

        <div style="width:280px;">
          <div class="small" data-i18n="charactersUsed">Characters used</div>
          <div class="checkboxes" style="margin-top:8px;">
            <label><input id="upper" type="checkbox" checked /> <span data-i18n="uppercase">Uppercase</span></label>
            <label><input id="lower" type="checkbox" checked /> <span data-i18n="lowercase">Lowercase</span></label>
            <label><input id="numbers" type="checkbox" checked /> <span data-i18n="numbers">Numbers</span></label>
            <label><input id="symSimple" type="checkbox" checked /> <span data-i18n="symbolsSimple">Symbols</span> <span class="hint" data-i18n="simple">(Simple)</span></label>
            <label><input id="symComplex" type="checkbox" /> <span data-i18n="symbolsComplex">Symbols</span> <span class="hint" data-i18n="complex">(Complex)</span></label>
          </div>
        </div>
      </div>

      <div class="row" style="margin-top:12px; flex-direction:column; align-items:flex-start;">
        <label><input id="avoidRepeats" type="checkbox" checked /> <span data-i18n="avoidRepeats">Avoid immediate repeated characters</span></label>
        <label><input id="avoidSequential" type="checkbox" /> <span data-i18n="avoidSequential">Avoid sequential runs (e.g. abc, 123)</span></label>
        <span class="hint" data-i18n="minMax">Min length 5 ‚Äî Max 100</span>
      </div>
    </div>

    <div class="footer">
      <div class="strength-container">
        <div id="strengthBar" class="strength-bar"></div>
      </div>
      <div id="strengthLabel" class="strength-label">Strength: ‚Äî</div>

      <div class="history-section">
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px;">
          <div class="history-title" data-i18n="history">Password History (Last 5)</div>
          <button id="clearHistoryBtn" class="btn btn-refresh" style="padding:6px 10px; font-size:12px;" data-i18n="clear">Clear</button>
        </div>
        <div id="historyList" class="history-list"></div>
      </div>
    </div>
  </div>

  <script>
    // Character sets
    const UPPER = "ABCDEFGHIJKLMNOPQRSTUVWXYZ";
    const LOWER = "abcdefghijklmnopqrstuvwxyz";
    const NUMS  = "0123456789";
    const SIMPLE_SYM = "!@#$%&*?";
    const COMPLEX_SYM = "~^()_-+=[]{}|;:'\",.<>/\\`‚Ç¨¬£¬•‚Ä¢";

    // Translations
    const translations = {
      en: {
        title: "Password generator",
        passwordLength: "Password length:",
        charactersUsed: "Characters used",
        uppercase: "Uppercase",
        lowercase: "Lowercase",
        numbers: "Numbers",
        symbolsSimple: "Symbols",
        symbolsComplex: "Symbols",
        simple: "(Simple)",
        complex: "(Complex)",
        avoidRepeats: "Avoid immediate repeated characters",
        avoidSequential: "Avoid sequential runs (e.g. abc, 123)",
        minMax: "Min length 5 ‚Äî Max 100",
        strength: "Strength:",
        refresh: "‚ü≤ Refresh",
        copy: "Copy password",
        copied: "Copied!",
        history: "Password History (Last 5)",
        clear: "Clear",
        weak: "Weak",
        fair: "Fair",
        medium: "Medium",
        strong: "Strong",
        veryStrong: "Very strong"
      },
      es: {
        title: "Generador de contrase√±a",
        passwordLength: "Longitud de contrase√±a:",
        charactersUsed: "Caracteres utilizados",
        uppercase: "May√∫sculas",
        lowercase: "Min√∫sculas",
        numbers: "N√∫meros",
        symbolsSimple: "S√≠mbolos",
        symbolsComplex: "S√≠mbolos",
        simple: "(Simple)",
        complex: "(Complejo)",
        avoidRepeats: "Evitar caracteres repetidos inmediatos",
        avoidSequential: "Evitar secuencias consecutivas (p. ej. abc, 123)",
        minMax: "Longitud m√≠n. 5 ‚Äî M√°x. 100",
        strength: "Fortaleza:",
        refresh: "‚ü≤ Actualizar",
        copy: "Copiar contrase√±a",
        copied: "¬°Copiado!",
        history: "Historial de contrase√±a (√öltimas 5)",
        clear: "Limpiar",
        weak: "D√©bil",
        fair: "Aceptable",
        medium: "Media",
        strong: "Fuerte",
        veryStrong: "Muy fuerte"
      }
    };

    let currentLanguage = 'en';

    // DOM elements
    const passwordField = document.getElementById('passwordField');
    const lengthRange = document.getElementById('lengthRange');
    const lengthInput = document.getElementById('lengthInput');
    const refreshBtn = document.getElementById('refreshBtn');
    const copyBtn = document.getElementById('copyBtn');
    const upperEl = document.getElementById('upper');
    const lowerEl = document.getElementById('lower');
    const numbersEl = document.getElementById('numbers');
    const symSimpleEl = document.getElementById('symSimple');
    const symComplexEl = document.getElementById('symComplex');
    const avoidRepeatsEl = document.getElementById('avoidRepeats');
    const avoidSequentialEl = document.getElementById('avoidSequential');
    const strengthLabel = document.getElementById('strengthLabel');
    const strengthBar = document.getElementById('strengthBar');
    const historyList = document.getElementById('historyList');
    const clearHistoryBtn = document.getElementById('clearHistoryBtn');
    const langEnBtn = document.getElementById('langEnBtn');
    const langEsBtn = document.getElementById('langEsBtn');
    let passwordHistory = [];

    function buildCharset() {
      let charset = "";
      const activeCategories = [];
      if (upperEl.checked) { charset += UPPER; activeCategories.push(UPPER); }
      if (lowerEl.checked) { charset += LOWER; activeCategories.push(LOWER); }
      if (numbersEl.checked) { charset += NUMS; activeCategories.push(NUMS); }
      if (symSimpleEl.checked) { charset += SIMPLE_SYM; activeCategories.push(SIMPLE_SYM); }
      if (symComplexEl.checked) { charset += COMPLEX_SYM; activeCategories.push(COMPLEX_SYM); }
      return { charset, activeCategories };
    }

    function randInt(max) {
      if (window.crypto && window.crypto.getRandomValues) {
        const array = new Uint32Array(1);
        window.crypto.getRandomValues(array);
        return array[0] % max;
      } else return Math.floor(Math.random() * max);
    }

    function shuffle(arr) {
      for (let i = arr.length - 1; i > 0; i--) {
        const j = randInt(i + 1);
        [arr[i], arr[j]] = [arr[j], arr[i]];
      }
      return arr;
    }

    // Detect sequential runs like "abc", "123", or reverse "cba", "321"
    function hasSequentialRun(pw) {
      const seqs = [];
      for (let i = 0; i < pw.length - 2; i++) {
        const a = pw.charCodeAt(i);
        const b = pw.charCodeAt(i + 1);
        const c = pw.charCodeAt(i + 2);
        if ((b === a + 1 && c === b + 1) || (b === a - 1 && c === b - 1)) return true;
      }
      return false;
    }

    function generatePassword(length) {
      const { charset, activeCategories } = buildCharset();
      if (!charset) return { pw: "", reason: "Select at least one character set." };
      if (length < 1) return { pw: "", reason: "Invalid length." };

      const mandatory = [];
      for (const cat of activeCategories) mandatory.push(cat.charAt(randInt(cat.length)));

      const remainingCount = length - mandatory.length;
      if (remainingCount < 0)
        return { pw: "", reason: `Length too short for chosen categories.` };

      const result = [...mandatory];
      const avoidRepeats = avoidRepeatsEl.checked;
      const avoidSequential = avoidSequentialEl.checked;

      let attempt = 0;
      while (result.length < length) {
        let ch = charset.charAt(randInt(charset.length));
        if (avoidRepeats && result.length > 0 && ch === result[result.length - 1]) continue;
        result.push(ch);
        attempt++;
        if (attempt > 500) break;
      }

      shuffle(result);

      // Remove any repeated or sequential runs post-generation if enabled
      if (avoidRepeats) {
        for (let i = 1; i < result.length; i++) {
          if (result[i] === result[i - 1]) {
            result[i] = charset.charAt(randInt(charset.length));
          }
        }
      }

      let pw = result.join("");

      // If avoiding sequential runs, regenerate up to a few times
      if (avoidSequential) {
        let tries = 0;
        while (hasSequentialRun(pw) && tries < 10) {
          pw = generatePassword(length).pw;
          tries++;
        }
      }

      return { pw, reason: null };
    }

    function estimateStrength(pw) {
      if (!pw) return { label: "‚Äî", score: 0 };
      
      const len = pw.length;
      let charsetSize = 0;
      let hasUpper = /[A-Z]/.test(pw);
      let hasLower = /[a-z]/.test(pw);
      let hasNumbers = /[0-9]/.test(pw);
      let hasSymbols = /[^A-Za-z0-9]/.test(pw);
      
      // Calculate charset size based on character types present
      if (hasUpper) charsetSize += 26;
      if (hasLower) charsetSize += 26;
      if (hasNumbers) charsetSize += 10;
      if (hasSymbols) charsetSize += 32; // Approximate
      
      // Calculate entropy in bits: log2(charsetSize^length)
      // Simplified: entropy = len * log2(charsetSize)
      const entropy = len * Math.log2(charsetSize);
      
      // NIST & OWASP standards for entropy:
      // Very strong: 80+ bits with all 4 character types
      // Strong: 60-79 bits with mixed types
      // Medium: 40-59 bits with at least 2 types
      // Weak: <40 bits or insufficient character diversity
      
      let strength = "Weak";
      let pct = 20;
      let typeCount = (hasUpper ? 1 : 0) + (hasLower ? 1 : 0) + (hasNumbers ? 1 : 0) + (hasSymbols ? 1 : 0);
      
      if (entropy >= 80 && typeCount === 4) {
        strength = "Very strong";
        pct = 100;
      } else if (entropy >= 60 && typeCount >= 3) {
        strength = "Strong";
        pct = 80;
      } else if (entropy >= 40 && typeCount >= 2) {
        strength = "Medium";
        pct = 60;
      } else if (entropy >= 30 && typeCount >= 2) {
        strength = "Fair";
        pct = 40;
      } else {
        strength = "Weak";
        pct = 20;
      }
      
      return { label: strength, score: pct };
    }

    function updateHistory(pw) {
      if (!pw) return;
      // Remove if it already exists (to avoid duplicates and move it to top)
      passwordHistory = passwordHistory.filter(p => p !== pw);
      // Add to front
      passwordHistory.unshift(pw);
      // Keep only last 5
      passwordHistory = passwordHistory.slice(0, 5);
      renderHistory();
    }

    function renderHistory() {
      historyList.innerHTML = '';
      passwordHistory.forEach((pw, index) => {
        const item = document.createElement('div');
        item.className = 'history-item';
        const copyBtn = document.createElement('button');
        copyBtn.className = 'history-copy-btn';
        copyBtn.textContent = translations[currentLanguage].copy;
        copyBtn.addEventListener('click', async () => {
          try {
            await navigator.clipboard.writeText(pw);
            copyBtn.textContent = translations[currentLanguage].copied;
            setTimeout(() => (copyBtn.textContent = translations[currentLanguage].copy), 1400);
          } catch {
            copyBtn.select();
            document.execCommand('copy');
            copyBtn.textContent = translations[currentLanguage].copied;
            setTimeout(() => (copyBtn.textContent = translations[currentLanguage].copy), 1400);
          }
        });
        item.innerHTML = `<span>${pw}</span>`;
        item.appendChild(copyBtn);
        historyList.appendChild(item);
      });
    }

    function updateLanguage(lang) {
      currentLanguage = lang;
      
      // Update button styles
      if (lang === 'en') {
        langEnBtn.style.background = '#e8f0ff';
        langEnBtn.style.color = '#0b66c3';
        langEnBtn.style.borderColor = '#0b66c3';
        langEsBtn.style.background = '#f0f0f0';
        langEsBtn.style.color = '#666';
        langEsBtn.style.borderColor = '#ddd';
      } else {
        langEsBtn.style.background = '#e8f0ff';
        langEsBtn.style.color = '#0b66c3';
        langEsBtn.style.borderColor = '#0b66c3';
        langEnBtn.style.background = '#f0f0f0';
        langEnBtn.style.color = '#666';
        langEnBtn.style.borderColor = '#ddd';
      }
      
      // Update all elements with data-i18n attribute
      const t = translations[lang];
      document.querySelectorAll('[data-i18n]').forEach(el => {
        const key = el.getAttribute('data-i18n');
        if (t[key]) {
          el.textContent = t[key];
        }
      });
      
      // Update title
      document.querySelector('h1').textContent = t.title;
      
      renderHistory();
      refreshPassword();
    }

    function refreshPassword() {
      const length = Math.max(5, Math.min(100, Number(lengthRange.value || 20)));
      const { pw, reason } = generatePassword(length);
      if (reason) {
        passwordField.value = reason;
        strengthLabel.textContent = translations[currentLanguage].strength + " ‚Äî";
        strengthBar.style.width = "0%";
        strengthBar.style.background = "#ccc";
      } else {
        passwordField.value = pw;
        autoResizePasswordField();
        const { label, score } = estimateStrength(pw);
        const translatedLabel = translations[currentLanguage][
          label === "Very strong" ? "veryStrong" :
          label === "Strong" ? "strong" :
          label === "Medium" ? "medium" :
          label === "Fair" ? "fair" :
          "weak"
        ];
        strengthLabel.textContent = translations[currentLanguage].strength + " " + translatedLabel;
        strengthBar.style.width = score + "%";
        strengthBar.style.background =
          label === "Very strong" ? "#2a8a44" :
          label === "Strong" ? "#4caf50" :
          label === "Medium" ? "#ffc107" :
          "#f44336";
      }
    }

    function autoResizePasswordField() {
      passwordField.style.height = '0px';
      const scrollHeight = passwordField.scrollHeight;
      passwordField.style.height = scrollHeight + 'px';
    }

    // Event listeners
    lengthRange.addEventListener('input', () => {
      lengthInput.value = lengthRange.value;
      refreshPassword();
    });
    lengthInput.addEventListener('change', () => {
      let val = Math.max(5, Math.min(100, Number(lengthInput.value || 5)));
      lengthRange.value = val;
      lengthInput.value = val;
      refreshPassword();
    });
    [lengthRange, upperEl, lowerEl, numbersEl, symSimpleEl, symComplexEl, avoidRepeatsEl, avoidSequentialEl]
      .forEach(el => {
        el.addEventListener('change', refreshPassword);
        el.addEventListener('input', refreshPassword);
      });
    refreshBtn.addEventListener('click', refreshPassword);
    clearHistoryBtn.addEventListener('click', () => {
      passwordHistory = [];
      renderHistory();
    });
    langEnBtn.addEventListener('click', () => updateLanguage('en'));
    langEsBtn.addEventListener('click', () => updateLanguage('es'));
    copyBtn.addEventListener('click', async () => {
      const txt = passwordField.value;
      if (!txt) return;
      updateHistory(txt);
      try {
        await navigator.clipboard.writeText(txt);
        copyBtn.textContent = translations[currentLanguage].copied;
        setTimeout(() => (copyBtn.textContent = translations[currentLanguage].copy), 1400);
      } catch {
        passwordField.select();
        document.execCommand('copy');
        copyBtn.textContent = translations[currentLanguage].copied;
        setTimeout(() => (copyBtn.textContent = translations[currentLanguage].copy), 1400);
      }
    });

    updateLanguage('en');
    refreshPassword();
  </script>
</body>
</html>
